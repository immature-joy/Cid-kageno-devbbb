<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nano Banana | AI Image Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial; margin: 20px; background: #f7f7f7; }
  .box { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 0 10px #0001; }
  .btn { padding: 10px 15px; border: none; background: #ffc93c; color: #000; border-radius: 8px; cursor: pointer; font-weight: bold; }
  .btn:hover { background: #ffb800; }
  textarea, input { width: 100%; padding: 10px; margin: 8px 0; }
  canvas { width: 100%; border: 1px solid #ccc; margin-top: 10px; border-radius: 8px; }
</style>
</head>
<body>

<h1>üçå Nano Banana ‚Äì AI Image Generator & Editor</h1>

<div class="box">
  <h2>Generate Image</h2>
  <textarea id="genPrompt" placeholder="Describe your image..."></textarea>
  <button class="btn" onclick="generate()">Generate</button>
  <p id="genStatus"></p>
</div>

<div class="box">
  <h2>Edit Image</h2>
  <input type="file" id="editFile" accept="image/*">
  <textarea id="editPrompt" placeholder="Describe edit..."></textarea>
  <button class="btn" onclick="editImage()">Edit Image</button>
  <p id="editStatus"></p>
</div>

<div class="box">
  <h2>Preview</h2>
  <canvas id="canvas" width="512" height="512"></canvas>
  <button class="btn" onclick="download()">Download</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function showImage(url) {
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  img.src = url;
}

async function generate() {
  const prompt = document.getElementById('genPrompt').value;
  document.getElementById('genStatus').innerText = "Generating...";

  const r = await fetch('/api/generate', {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ prompt })
  });

  const j = await r.json();
  const url = j.imageUrl || j.data?.[0]?.url || ("data:image/png;base64," + j.base64);
  if (!url) return alert("Error: no image returned");

  showImage(url);
  document.getElementById('genStatus').innerText = "Done!";
}

async function editImage() {
  const file = document.getElementById('editFile').files[0];
  if (!file) return alert("Upload an image first.");
  const prompt = document.getElementById('editPrompt').value;
  document.getElementById('editStatus').innerText = "Editing...";

  const fd = new FormData();
  fd.append("image", file);
  fd.append("prompt", prompt);

  const r = await fetch('/api/edit', { method: "POST", body: fd });
  const j = await r.json();
  const url = j.imageUrl || j.data?.[0]?.url || ("data:image/png;base64," + j.base64);

  if (!url) return alert("Error: no edited image returned");

  showImage(url);
  document.getElementById('editStatus').innerText = "Done!";
}

function download() {
  const link = document.createElement('a');
  link.download = "nano-banana.png";
  link.href = canvas.toDataURL();
  link.click();
}
</script>

</body>
</html>
